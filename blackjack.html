<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blackjack â€” Simple</title>
  <style>
    :root{
      --bg:#0b1320;
      --card:#ffffff;
      --muted:#9fb0c7;
      --accent:#3ddc84;
      --panel:#0f2433;
      --glass: rgba(255,255,255,0.04);
      --red:#d32f2f;
      --green:#2e7d32;
      --shadow: 0 8px 20px rgba(0,0,0,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(61,220,132,0.06), transparent 10%),
        linear-gradient(180deg,#071122 0%, #051826 100%);
      color:var(--card);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      box-sizing:border-box;
    }
    .app{
      width:960px;
      max-width:96vw;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      padding:18px;
      box-shadow:var(--shadow);
      display:grid;
      grid-template-columns: 1fr 340px;
      gap:18px;
    }

    /* Left: table */
    .table{
      background: linear-gradient(180deg,#07212b, #04141a);
      border-radius:10px;
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:420px;
    }
    .status{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    h1{font-size:20px;margin:0;color:var(--muted)}
    .message{
      font-size:16px;
      color:var(--card);
      background:var(--glass);
      padding:10px 12px;
      border-radius:8px;
      min-width:220px;
      text-align:center;
    }

    .board{
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .hand{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      border-radius:8px;
      padding:12px;
      min-width:240px;
      flex:1;
      box-shadow: inset 0 -2px 8px rgba(0,0,0,0.2);
    }
    .hand .title{font-size:13px;color:var(--muted);margin-bottom:8px}
    .cards{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .card{
      width:72px;
      height:96px;
      border-radius:8px;
      background:var(--card);
      color:#000;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      padding:8px;
      box-shadow:0 6px 12px rgba(0,0,0,0.45);
      font-weight:600;
      transition:transform .12s ease, opacity .12s ease;
      position:relative;
    }
    .card.face-down{
      background:linear-gradient(135deg,#173a4a,#0a2430);
      color:white;
      transform:rotateY(0);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:22px;
      letter-spacing:1px;
    }
    .card .top, .card .bot{font-size:14px}
    .card .center{font-size:28px;text-align:center;line-height:1}
    .card.red{color:var(--red)}
    .card.black{color:#111}

    .controls{
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:stretch;
    }
    .controls .btn-row{
      display:flex;
      gap:8px;
    }
    .btn{
      background:linear-gradient(180deg,#2a4b5a,#1b2f39);
      color:var(--card);
      border:none;
      padding:10px 14px;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
      letter-spacing:0.6px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.45);
      transition:transform .08s ease, opacity .08s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
    .btn.positive{background:linear-gradient(180deg,#45e28f,#1fa66a); color:#022; box-shadow:0 6px 20px rgba(31,166,106,0.28)}
    .btn.warn{background:linear-gradient(180deg,#ffd88a,#ffb248); color:#3b2300}
    .btn.disabled{opacity:0.5;pointer-events:none}

    .sidebar{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:10px;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-width:260px;
    }
    .score{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:8px;
      background:var(--panel);
      border-radius:8px;
      align-items:center;
    }
    .score .label{color:var(--muted);font-size:13px}
    .score .value{font-size:18px;font-weight:800}

    .small{font-size:13px;color:var(--muted)}
    .footer{display:flex;align-items:center;justify-content:space-between;gap:8px}

    .history{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:var(--glass); padding:8px 10px;border-radius:999px;font-weight:700;color:var(--muted)}

    .result{
      padding:10px;
      border-radius:8px;
      text-align:center;
      font-weight:800;
    }
    .result.win{background:linear-gradient(90deg,#093 10%, #1fa66a); color:#012}
    .result.lose{background:linear-gradient(90deg,#d32f2f,#8a1a1a); color:#fff}
    .result.push{background:linear-gradient(90deg,#6b7280,#374151); color:#fff}

    /* responsive */
    @media (max-width:900px){
      .app{grid-template-columns:1fr; padding:12px}
      .sidebar{order:2}
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Blackjack game">
    <div class="table" id="table">
      <div class="status">
        <h1>Blackjack â€” Player vs Dealer</h1>
        <div class="message" id="message">Click Deal to begin.</div>
      </div>

      <div class="board" aria-live="polite">
        <div class="hand" id="dealerHand">
          <div class="title">Dealer <span class="small" id="dealerValue">(?)</span></div>
          <div class="cards" id="dealerCards" aria-label="Dealer cards"></div>
        </div>

        <div class="hand" id="playerHand">
          <div class="title">Player <span class="small" id="playerValue">(0)</span></div>
          <div class="cards" id="playerCards" aria-label="Player cards"></div>
        </div>
      </div>

      <div class="controls">
        <div class="btn-row">
          <button id="dealBtn" class="btn positive">Deal</button>
          <button id="hitBtn" class="btn" disabled>Hit</button>
          <button id="standBtn" class="btn warn" disabled>Stand</button>
          <button id="newRoundBtn" class="btn secondary" disabled>New Round</button>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <label class="small" style="margin-right:8px">Bet (visual):</label>
          <div class="chip">$10</div>
          <div class="small" style="margin-left:auto">Version: Lite</div>
        </div>
      </div>
    </div>

    <aside class="sidebar" aria-label="Game controls and stats">
      <div class="score">
        <div>
          <div class="label">Wins</div>
          <div class="value" id="wins">0</div>
        </div>
        <div>
          <div class="label">Losses</div>
          <div class="value" id="losses">0</div>
        </div>
        <div>
          <div class="label">Pushes</div>
          <div class="value" id="pushes">0</div>
        </div>
      </div>

      <div>
        <div class="small">Round history</div>
        <div class="history" id="history"></div>
      </div>

      <div>
        <div class="small">Quick rules</div>
        <ul style="margin:8px 0 0 18px;color:var(--muted);padding:0;line-height:1.6">
          <li>Dealer stands on 17 (including soft 17)</li>
          <li>Ace counts as 1 or 11</li>
          <li>Tie = Push</li>
        </ul>
      </div>

      <div class="footer">
        <button id="resetScore" class="btn secondary">Reset Score</button>
        <button id="restartBtn" class="btn" title="Reset game">Reset</button>
      </div>
    </aside>
  </div>

  <script>
    // -- Game state and utilities
    const SUITS = ['â™ ','â™¥','â™¦','â™£'];
    const RANKS = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

    function createDeck(){
      const d = [];
      for(const s of SUITS){
        for(const r of RANKS){
          d.push({suit:s, rank:r, code: r + s});
        }
      }
      return d;
    }

    function shuffle(deck){
      // Fisher-Yates
      for(let i = deck.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i+1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }

    function cardValue(card){
      if(card.rank === 'A') return 11;
      if(['J','Q','K'].includes(card.rank)) return 10;
      return parseInt(card.rank,10);
    }

    function handValue(cards){
      // returns {min: x, best: y, isSoft: bool}
      let total = 0;
      let aces = 0;
      for(const c of cards){
        if(c.rank === 'A') { aces++; total += 11; }
        else total += cardValue(c);
      }
      // reduce ace(s) from 11 to 1 as needed
      while(total > 21 && aces > 0){
        total -= 10;
        aces--;
      }
      const isSoft = cards.some(c => c.rank === 'A') && total <= 21;
      return {total, isSoft};
    }

    // DOM references
    const dealerCardsEl = document.getElementById('dealerCards');
    const playerCardsEl = document.getElementById('playerCards');
    const playerValueEl = document.getElementById('playerValue');
    const dealerValueEl = document.getElementById('dealerValue');
    const messageEl = document.getElementById('message');

    const dealBtn = document.getElementById('dealBtn');
    const hitBtn = document.getElementById('hitBtn');
    const standBtn = document.getElementById('standBtn');
    const newRoundBtn = document.getElementById('newRoundBtn');
    const restartBtn = document.getElementById('restartBtn');
    const resetScoreBtn = document.getElementById('resetScore');

    const winsEl = document.getElementById('wins');
    const lossesEl = document.getElementById('losses');
    const pushesEl = document.getElementById('pushes');
    const historyEl = document.getElementById('history');

    // Scoreboard persisted in localStorage
    let scoreboard = JSON.parse(localStorage.getItem('bj_score')) || {wins:0,losses:0,pushes:0,history:[]};
    function saveScore(){ localStorage.setItem('bj_score', JSON.stringify(scoreboard)); }
    function renderScore(){
      winsEl.textContent = scoreboard.wins;
      lossesEl.textContent = scoreboard.losses;
      pushesEl.textContent = scoreboard.pushes;
      historyEl.innerHTML = '';
      for(const h of scoreboard.history.slice(-8).reverse()){
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.textContent = h;
        historyEl.appendChild(chip);
      }
    }

    renderScore();

    // Game variables
    let deck = [];
    let player = [];
    let dealer = [];
    let dealerHole = null; // face-down card
    let roundActive = false;

    // Helpers: render card element
    function makeCardEl(card, faceDown=false){
      const el = document.createElement('div');
      el.className = 'card' + (faceDown ? ' face-down' : '');
      if(faceDown){
        el.textContent = 'ðŸ‚ ';
        return el;
      }
      // color for suits: hearts/diamonds red
      const red = (card.suit === 'â™¥' || card.suit === 'â™¦');
      if(red) el.classList.add('red'); else el.classList.add('black');

      const top = document.createElement('div');
      top.className = 'top';
      top.textContent = card.rank + card.suit;
      const center = document.createElement('div');
      center.className = 'center';
      center.textContent = card.suit;
      const bot = document.createElement('div');
      bot.className = 'bot';
      bot.textContent = card.rank + card.suit;
      el.append(top, center, bot);
      return el;
    }

    function renderHands(hideDealerHole=true){
      dealerCardsEl.innerHTML = '';
      playerCardsEl.innerHTML = '';

      // Dealer
      dealer.forEach((c, idx) => {
        const isHole = (idx === 0 && dealerHole !== null && hideDealerHole);
        const el = makeCardEl(isHole ? null : c, isHole);
        dealerCardsEl.appendChild(el);
      });

      // Player
      player.forEach(c => {
        playerCardsEl.appendChild(makeCardEl(c, false));
      });

      // Values
      const pv = handValue(player).total;
      playerValueEl.textContent = `(${pv})`;
      if(!roundActive && dealer.length>0 && !hideDealerHole){
        dealerValueEl.textContent = `(${handValue(dealer).total})`;
      } else if(dealer.length>0 && hideDealerHole){
        // show only visible card(s)
        const visible = dealer.slice(1);
        if(visible.length === 0){
          dealerValueEl.textContent = '(?)';
        } else {
          const v = visible.reduce((s,c)=>s+cardValue(c),0);
          dealerValueEl.textContent = `(? + ${v})`;
        }
      } else dealerValueEl.textContent='(?)';
    }

    // Deal a card
    function dealCard(toDealer=false){
      if(deck.length === 0) deck = shuffle(createDeck());
      const c = deck.pop();
      if(toDealer){
        dealer.push(c);
      } else {
        player.push(c);
      }
      return c;
    }

    // Start or deal initial round
    function startRound(){
      // reset
      deck = shuffle(createDeck());
      player = [];
      dealer = [];
      dealerHole = null;
      roundActive = true;

      // initial dealing: dealer gets a hole card then a face up card; player gets two cards
      // We'll push hole as first dealer card and hide.
      dealer.push(deck.pop()); // hole
      dealer.push(deck.pop()); // face-up
      player.push(deck.pop());
      player.push(deck.pop());

      renderHands(true);
      messageEl.textContent = 'Your move: Hit or Stand.';
      dealBtn.disabled = true;
      hitBtn.disabled = false;
      standBtn.disabled = false;
      newRoundBtn.disabled = true;
      updateButtons();
      // Check immediate blackjack(s)
      setTimeout(() => {
        checkInitialBlackjack();
      }, 200);
    }

    function checkInitialBlackjack(){
      const pVal = handValue(player).total;
      const dVal = handValue(dealer).total;
      const playerBJ = (pVal === 21 && player.length === 2);
      const dealerBJ = (dVal === 21 && dealer.length === 2);
      if(playerBJ || dealerBJ){
        // reveal dealer hole and finish
        endPlayerTurn(true);
      }
    }

    // Player actions
    function playerHit(){
      if(!roundActive) return;
      player.push(deck.pop());
      renderHands(true);
      const {total} = handValue(player);
      if(total > 21){
        // player bust
        endRound('dealer-bust'); // will detect as player loss
      } else if(total === 21){
        // auto-stand
        endPlayerTurn(false);
      } else {
        messageEl.textContent = 'Your move: Hit or Stand.';
      }
    }

    // End player's turn -> dealer plays
    function endPlayerTurn(fromBlackjack=false){
      hitBtn.disabled = true;
      standBtn.disabled = true;
      renderHands(false);
      messageEl.textContent = 'Dealer\'s turn...';
      // Reveal dealer's hole card (dealer[0] is already there)
      // Dealer draws according to rules: hit until >= 17 (stand on soft 17)
      setTimeout(() => {
        dealerPlay(fromBlackjack);
      }, 600);
    }

    function dealerPlay(fromBlackjack=false){
      // If dealer has blackjack and player also does -> push; else dealer wins.
      const dh = handValue(dealer);
      const ph = handValue(player);
      // if dealer has blackjack and player doesn't -> dealer wins immediately
      if(dh.total === 21 && dealer.length === 2 && !(ph.total === 21 && player.length === 2)){
        // reveal and end
        renderHands(false);
        endRound('dealer-blackjack');
        return;
      }
      // Otherwise continue drawing
      function dealerShouldHit(){
        const hv = handValue(dealer);
        // if total < 17 -> hit
        if(hv.total < 17) return true;
        // if total > 17 -> stand
        if(hv.total > 17) return false;
        // total == 17 -> check soft 17 (soft means an ace counted as 11)
        // this implementation: dealer stands on soft 17
        return false;
      }

      // loop draws with modest delay for UX
      const drawStep = () => {
        renderHands(false);
        if(dealerShouldHit()){
          setTimeout(() => {
            dealer.push(deck.pop());
            renderHands(false);
            if(handValue(dealer).total > 21){
              // dealer busts
              setTimeout(()=>endRound('dealer-bust'), 300);
            } else {
              setTimeout(drawStep, 500);
            }
          }, 450);
        } else {
          // dealer stands -> determine winner
          setTimeout(() => endRound('compare'), 400);
        }
      };

      // immediate drawStep
      setTimeout(drawStep, 350);
    }

    // Determine result and update UI / scoreboard
    function endRound(reason){
      roundActive = false;
      hitBtn.disabled = true;
      standBtn.disabled = true;
      dealBtn.disabled = true;
      newRoundBtn.disabled = false;
      renderHands(false);

      const pVal = handValue(player).total;
      const dVal = handValue(dealer).total;

      let result = '';
      if(reason === 'dealer-blackjack'){
        // dealer had blackjack
        if(pVal === 21 && player.length === 2){
          result = 'push';
          scoreboard.pushes++;
        } else {
          result = 'lose';
          scoreboard.losses++;
        }
      } else if(reason === 'dealer-bust'){
        // dealer busted => player wins (assuming player didn't bust earlier)
        if(pVal > 21){
          result = 'lose';
          scoreboard.losses++;
        } else {
          result = 'win';
          scoreboard.wins++;
        }
      } else if(reason === 'compare'){
        // compare totals
        if(pVal > 21){
          result = 'lose';
          scoreboard.losses++;
        } else if(dVal > 21){
          result = 'win';
          scoreboard.wins++;
        } else if(pVal > dVal){
          result = 'win';
          scoreboard.wins++;
        } else if(pVal < dVal){
          result = 'lose';
          scoreboard.losses++;
        } else {
          result = 'push';
          scoreboard.pushes++;
        }
      } else {
        // fallback
        if(pVal > 21) { result='lose'; scoreboard.losses++; }
        else if(pVal === dVal) { result='push'; scoreboard.pushes++; }
        else if(pVal > dVal) { result='win'; scoreboard.wins++; }
        else { result='lose'; scoreboard.losses++; }
      }

      // message
      if(result === 'win'){
        messageEl.textContent = `You win! Player ${pVal} â€” Dealer ${dVal}`;
        showResult('win','You win');
        addHistory('W');
      } else if(result === 'lose'){
        messageEl.textContent = `You lose. Player ${pVal} â€” Dealer ${dVal}`;
        showResult('lose','You lose');
        addHistory('L');
      } else {
        messageEl.textContent = `Push. Player ${pVal} â€” Dealer ${dVal}`;
        showResult('push','Push');
        addHistory('P');
      }

      saveScore();
      renderScore();
      updateButtons();
    }

    function showResult(type, text){
      // small ephemeral highlight on message area
      messageEl.classList.remove('win','lose','push');
      messageEl.classList.add(type === 'win' ? 'win' : type === 'lose' ? 'lose' : 'push');
      setTimeout(()=>{ messageEl.classList.remove('win','lose','push'); }, 2200);
    }

    function addHistory(symbol){
      scoreboard.history.push(symbol);
      if(scoreboard.history.length > 50) scoreboard.history.shift();
    }

    function endRoundImmediateLose(){
      roundActive = false;
      hitBtn.disabled = true;
      standBtn.disabled = true;
      newRoundBtn.disabled = false;
      dealBtn.disabled = true;
    }

    // UI state
    function updateButtons(){
      dealBtn.disabled = roundActive;
      hitBtn.disabled = !roundActive;
      standBtn.disabled = !roundActive;
      newRoundBtn.disabled = roundActive;
    }

    // Events
    dealBtn.addEventListener('click', () => {
      startRound();
    });

    hitBtn.addEventListener('click', () => {
      playerHit();
    });

    standBtn.addEventListener('click', () => {
      endPlayerTurn(false);
    });

    newRoundBtn.addEventListener('click', () => {
      // prepare new round using remaining deck (or reshuffle if low)
      if(deck.length < 10) deck = shuffle(createDeck()); // fresh deck
      player = [];
      dealer = [];
      dealerHole = null;
      roundActive = false;
      // UI reset
      dealerCardsEl.innerHTML = '';
      playerCardsEl.innerHTML = '';
      playerValueEl.textContent='(0)';
      dealerValueEl.textContent='(?)';
      messageEl.textContent = 'Click Deal to begin.';
      dealBtn.disabled = false;
      newRoundBtn.disabled = true;
      hitBtn.disabled = true;
      standBtn.disabled = true;
      updateButtons();
    });

    restartBtn.addEventListener('click', ()=> {
      // full restart of UI and deck
      deck = shuffle(createDeck());
      player = [];
      dealer = [];
      dealerHole = null;
      roundActive = false;
      dealerCardsEl.innerHTML = '';
      playerCardsEl.innerHTML = '';
      playerValueEl.textContent='(0)';
      dealerValueEl.textContent='(?)';
      messageEl.textContent = 'Click Deal to begin.';
      dealBtn.disabled = false;
      hitBtn.disabled = true;
      standBtn.disabled = true;
      newRoundBtn.disabled = true;
    });

    resetScoreBtn.addEventListener('click', ()=> {
      if(confirm('Reset scoreboard?')){
        scoreboard = {wins:0,losses:0,pushes:0,history:[]};
        saveScore();
        renderScore();
      }
    });

    // keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'h' || e.key === 'H') { if(!hitBtn.disabled) playerHit(); }
      if(e.key === 's' || e.key === 'S') { if(!standBtn.disabled) endPlayerTurn(false); }
      if(e.key === 'd' || e.key === 'D') { if(!dealBtn.disabled) startRound(); }
    });

    // initial deck
    deck = shuffle(createDeck());
    renderHands(true);
    updateButtons();

    // Accessibility: announce changes
    // (messageEl is in aria-live context via parent)
  </script>
</body>
</html>
